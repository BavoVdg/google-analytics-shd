<!DOCTYPE html>
<html lang="en">
  <head>
    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-524MQ89");
    </script>
    <!-- End Google Tag Manager -->
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Google Analytics | SHD</title>
  </head>
  <body>
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-524MQ89"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <h1>Google Analytics - SHD</h1>
    <a href="./form.html">Form abandonment</a>
    <h2>Button clicks</h2>
    <button class="button header_button_click">
      Stuur header_button_click event
    </button>
    <button class="button button_1">Stuur button_1 event</button>
    <button class="button button_2">Stuur button_2 event</button>
    <button class="button button_3">Stuur button_3 event</button>
    <button class="button button_4">Stuur button_4 event</button>
    <h2>Form submit</h2>
    <form id="form" method="post">
      <label for="budget-input"
        >budget:
        <input
          id="budget-input"
          name="budget"
          type="range"
          min="0"
          max="1000"
        />
      </label>
      <label for="ecommerce-input"
        >e-commerce:
        <select id="ecommerce-input" name="ecommerce">
          <option value="yes">yes</option>
          <option value="no">no</option>
        </select>
      </label>
      <input type="submit" name="save" />
    </form>
    <h2>Users</h2>
    <p class="user-state">No cookies</p>
    <button onclick="updateUser('user 1')" class="button user_1">
      Log in - user 1
    </button>
    <button onclick="updateUser('user 2')" class="button user 1">
      Log in - user 2
    </button>
  </body>
  <script>
    // Version
    console.log("0.0.1");

    // Form - push data to data layer
    const form = document.querySelector("#form");
    form.addEventListener("submit", (e) => {
      e.preventDefault();
      const budget = document.querySelector("#budget-input").value;
      const ecommerce = document.querySelector("#ecommerce-input").value;

      localStorage.clear();
      window.dataLayer = window.dataLayer || [];
      window.dataLayer.push({
        budget,
        ecommerce,
      });
    });

    // Users
    // Show current cookies
    document.querySelector(
      ".user-state"
    ).innerHTML = `cookies: ${document.cookie}`;

    const updateUser = (value) => {
      const userState = document.querySelector(".user-state");
      if (userState.innerHTML.includes(value)) {
        // Clear user cookie
        removeUserIdCookie(value);
        window.location.reload();
      } else {
        // Set user cookie
        setUserIdCookie(value);
        window.location.reload();
      }
    };

    // Cookies
    const setUserIdCookie = (value) => {
      document.cookie = `userId=${value}; expires=Thu, 18 Dec 2030 12:00:00 UTC;`;
    };

    const removeUserIdCookie = (value) => {
      document.cookie = `userId=; expires=Thu, 01 Jan 1970 00:00:00 UTC;`;
    };
  </script>
</html>
